!function(o,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():o.Isometric=t()}(this,function(){"use strict";var o=64,t=32,e=0,n=0,l=0,r=0,i=null;function u(o,t){this.setDimensions(o,t),this.setOffset(.5*this.getWidth(),0)}function s(o,t,e){this.column=Math.floor(parseInt(o))||0,this.row=Math.floor(parseInt(t))||0;let n=e||{};this.color=n.color||"#000",this.img=n.img||null,this.offset=n.offset||0,this.selected=!1}function c(l,r){return{x:l*o*.5-r*o*.5+e,y:l*t*.5+r*t*.5+n}}function f(l,r){let i=.5*o,u=.5*t,s=1/(2*i*u);return{column:Math.floor(s*(l*u+r*i-(e*u+n*i))),row:Math.floor(s*(r*i-l*u+(e*u-n*i)))}}return u.prototype={init:function(o){"function"!=typeof o&&(o=function(o,t){return new s(o,t)}),i=new Array(r);for(let t=0;t<r;t++){i[t]=new Array(l);for(let e=0;e<l;e++)i[t][e]=o(e,t)}},setDimensions:function(o,t){l=parseInt(o)||l,r=parseInt(t)||r},setTileDimensions:function(e,n,l){let r=parseInt(e),i=parseInt(n);isNaN(r)||isNaN(i)||("cartesian"===l?(o=2*r,t=i):(o=r,t=i))},setOffset(o,t){let l=parseInt(o);isNaN(l)||(e=l);let r=parseInt(t);isNaN(r)||(n=r)},getWidth:function(){return l*o},getHeight:function(){return r*t},getTile:function(o,t){let e=(n=o,(u=t)?{x:n,y:u}:{x:n.x,y:n.y});var n,u;let s=f(e.x,e.y);return(s=function(o,t,e){let n=null,u=0,s=o.column,c=o.row;for(let m=1;m<=e;m++)o.column+m-1>=0&&o.column+m-1<l&&o.row+m>=0&&o.row+m<r&&(u=i[o.row+m][o.column+m-1].offset,(n=f(t.x,t.y+u)).column>=o.column+m-1&&n.row>=o.row+m&&(s=o.column+m-1,c=o.row+m)),o.column+m>=0&&o.column+m<l&&o.row+m-1>=0&&o.row+m-1<r&&(u=i[o.row+m-1][o.column+m].offset,(n=f(t.x,t.y+u)).column>=o.column+m&&n.row>=o.row+m-1&&(s=o.column+m,c=o.row+m-1)),o.column+m>=0&&o.column+m<l&&o.row+m>=0&&o.row+m<r&&(u=i[o.row+m][o.column+m].offset,(n=f(t.x,t.y+u)).column>=o.column+m&&n.row>=o.row+m&&(s=o.column+m,c=o.row+m));return{column:s,row:c}}(s,e,3)).row>=0&&s.row<r&&s.column>=0&&s.column<l?i[s.row][s.column]:null},selectTile:function(o,t){for(let o=0;o<r;o++)for(let t=0;t<l;t++)i[o][t].selected=!1;let e=this.getTile(o,t);null!=e&&e.row>=0&&e.row<r&&e.column>=0&&e.column<l&&(i[e.row][e.column].selected=!0)},draw:function(e){let n=null;for(let u=0;u<l;u++)for(let l=0;l<r;l++)n=c(u,l),i[l][u].draw(e,n.x,n.y,o,t)}},s.prototype={draw:function(o,t,e,n,l){let r=e-this.offset;null!=this.img?o.drawImage(this.img,t-.5*n,r,n,l+this.offset):this.drawColor(o,t,r,n,l),this.selected&&this.drawSelected(o,t,r,n,l)},drawColor:function(o,t,e,n,l){o.fillStyle=this.color,o.beginPath(),o.moveTo(t,e),o.lineTo(t+.5*n,e+.5*l),o.lineTo(t,e+l),o.lineTo(t-.5*n,e+.5*l),o.lineTo(t,e),o.fill()},drawSelected:function(o,t,e,n,l){o.strokeStyle="#333",o.fillStyle="rgba(255,255,255,0.2)",o.lineWidth=1,o.beginPath(),o.moveTo(t,e),o.lineTo(t+.5*n,e+.5*l),o.lineTo(t,e+l),o.lineTo(t-.5*n,e+.5*l),o.lineTo(t,e),o.fill(),o.stroke()}},{Map:u,Tile:s}});
